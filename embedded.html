<!-- UCPM DEMO VERSION 3.0 ‚Äì 20:15 -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UCPM DEMO VERSION 3.0</title>

  <style>
    body { margin:0; background:#f6f7f9; font-family:system-ui; }
    .wrap { max-width:980px; margin:0 auto; padding:24px; }

    .version-banner{
      background:#111827;
      color:#fff;
      padding:12px 16px;
      border-radius:12px;
      font-weight:700;
      margin-bottom:20px;
    }

    .card {
      background:#fff;
      border-radius:14px;
      padding:18px;
      box-shadow:0 2px 10px rgba(0,0,0,.06);
      border:1px solid #eef0f3;
    }

    .status{
      padding:10px;
      border-radius:8px;
      margin-bottom:12px;
      font-weight:600;
    }

    .loading{ background:#fff7ed; color:#b45309; }
    .ok{ background:#ecfdf5; color:#047857; }
    .error{ background:#fef2f2; color:#b91c1c; }

    .container{
      border:1px solid #e5e7eb;
      border-radius:12px;
      min-height:500px;
      padding:12px;
      overflow:visible;
    }

    #ucpm-embedded-form iframe{
      width:100% !important;
      min-height:600px;
      border:0 !important;
      display:block;
    }
  </style>

  <!-- OneTrust Stub -->
  <script
    defer
    src="https://privacyportaltrial.onetrust.com/consent-embedded-forms/consent-receipt-scripts/OtFormStub.js"
    data-id="86cfa775-f542-42b6-8f6d-30a22fc81ba1"
    worker="https://privacyportaltrial.onetrust.com"
  ></script>
</head>

<body>
  <div class="wrap">

    <div class="version-banner">
      üöÄ UCPM DEMO VERSION 3.0 ‚Äì OTSKD INSTALL FIX
    </div>

    <div id="statusBox" class="status loading">
      Loading OneTrust SDK...
    </div>

    <div id="ucpm-embedded-form" class="container">
      <button class="ot-open-webform" id="ot-0412853a-91ac-4d1b-ae16-0555b88fb877">
        Open web form
      </button>
    </div>

  </div>

  <script>
    const CP_ID = "86cfa775-f542-42b6-8f6d-30a22fc81ba1";
    const statusBox = document.getElementById("statusBox");
    const container = document.getElementById("ucpm-embedded-form");
    const btn = document.getElementById("ot-0412853a-91ac-4d1b-ae16-0555b88fb877");

    function setStatus(type, text){
      statusBox.className = "status " + type;
      statusBox.innerText = text;
    }

    function rendered(){
      const iframe = container.querySelector("iframe") || document.querySelector("iframe");
      if (iframe) {
        if (!container.contains(iframe)) {
          container.innerHTML = "";
          container.appendChild(iframe);
        }
        return true;
      }
      return false;
    }

    let tries = 0;
    const wait = setInterval(() => {
      tries++;

      if (typeof window.OtSdk === "function") {

        clearInterval(wait);
        setStatus("loading","OtSdk detected. Installing CP...");

        window.OtSdk("consent","RegisterEvent","external");
        window.OtSdk("consent","InstallCP",CP_ID,function(res){
          console.log("InstallCP callback:", res);
        });

        let openTries = 0;
        const opener = setInterval(() => {
          openTries++;
          btn.click();

          if (rendered()) {
            clearInterval(opener);
            setStatus("ok","‚úÖ Form rendered successfully.");
          }

          if (openTries > 20) {
            clearInterval(opener);
            setStatus("error","‚ùå Installed but nothing rendered. Likely CP type mismatch or wrong trigger ID.");
          }
        },500);

      }

      if (tries > 25) {
        clearInterval(wait);
        setStatus("error","‚ùå OtSdk not detected. Stub not fully initialised.");
      }

    },300);
  </script>

</body>
</html>
