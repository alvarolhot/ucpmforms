<!-- UCPM DEMO VERSION 3.1 ‚Äì 20:10 -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UCPM DEMO VERSION 3.1</title>

  <style>
    body { margin:0; background:#f6f7f9; font-family:system-ui; }
    .wrap { max-width:980px; margin:0 auto; padding:24px; }

    .version-banner{
      background:#111827; color:#fff; padding:12px 16px; border-radius:12px;
      font-weight:800; margin-bottom:16px;
    }

    .status{
      padding:10px 12px; border-radius:10px; margin-bottom:12px; font-weight:700;
      border:1px solid #e5e7eb;
    }
    .loading{ background:#fff7ed; color:#b45309; }
    .ok{ background:#ecfdf5; color:#047857; }
    .error{ background:#fef2f2; color:#b91c1c; }

    .container{
      border:1px solid #e5e7eb; border-radius:12px; min-height:520px;
      padding:12px; background:#fff; overflow:visible;
    }

    #ucpm-embedded-form iframe{
      width:100% !important; min-height:650px; border:0 !important; display:block;
    }
  </style>

  <!-- OneTrust Embedded Forms stub -->
  <script
    defer
    src="https://privacyportaltrial.onetrust.com/consent-embedded-forms/consent-receipt-scripts/OtFormStub.js"
    data-id="86cfa775-f542-42b6-8f6d-30a22fc81ba1"
    worker="https://privacyportaltrial.onetrust.com"
  ></script>
</head>

<body>
  <div class="wrap">
    <div class="version-banner">üöÄ UCPM DEMO VERSION 3.1 ‚Äì WEBFORM TARGET FIX</div>

    <div id="statusBox" class="status loading">Loading OneTrust‚Ä¶</div>

    <!-- IMPORTANT: this is the explicit target -->
    <div id="ucpm-embedded-form" class="container"></div>
  </div>

  <script>
    (function(){
      const CP_ID = "86cfa775-f542-42b6-8f6d-30a22fc81ba1";
      const statusBox = document.getElementById("statusBox");
      const targetEl = document.getElementById("ucpm-embedded-form");

      function setStatus(type, text){
        statusBox.className = "status " + type;
        statusBox.innerText = text;
      }

      function hasIframe(){
        return !!targetEl.querySelector("iframe");
      }

      function tryCall(obj, fnNames, args){
        for (const name of fnNames) {
          if (obj && typeof obj[name] === "function") {
            try { obj[name].apply(obj, args); return name; } catch(e) {}
          }
        }
        return null;
      }

      setStatus("loading","Waiting for OneTrust.webform‚Ä¶");

      let tries = 0;
      const wait = setInterval(() => {
        tries++;

        const webform = window.OneTrust && window.OneTrust.webform;
        if (webform) {
          clearInterval(wait);

          // Show what methods exist (useful)
          console.log("OneTrust.webform available. Methods:", Object.keys(webform || {}));

          setStatus("loading","webform detected. Installing CP into target‚Ä¶");

          // 1) Install CP (some tenants accept options including target/container)
          // We try multiple signatures safely.
          try {
            // Signature A: InstallCP(cpId, options, cb)
            if (typeof webform.InstallCP === "function") {
              webform.InstallCP(CP_ID, { target: "#ucpm-embedded-form", container: "#ucpm-embedded-form", inline: true }, function(r){
                console.log("InstallCP cb:", r);
              });
            }
          } catch (e) {
            console.log("InstallCP signature A failed:", e);
          }

          // 2) Then attempt an explicit render/open into target (varies by tenant)
          const renderFn = tryCall(webform,
            ["RenderCP","Render","ShowCP","Show","OpenCP","Open","LoadCP","Load"],
            [CP_ID, { target: "#ucpm-embedded-form", container: "#ucpm-embedded-form", inline: true }]
          );

          if (renderFn) {
            setStatus("loading",`Called ${renderFn}(). Waiting for iframe‚Ä¶`);
          } else {
            setStatus("loading","No Render/Open method found. Waiting for auto-render after InstallCP‚Ä¶");
          }

          // 3) Detect render
          let checkTries = 0;
          const checker = setInterval(() => {
            checkTries++;

            if (hasIframe()) {
              clearInterval(checker);
              setStatus("ok","‚úÖ Form rendered (iframe detected).");
            }

            if (checkTries > 30) {
              clearInterval(checker);
              setStatus("error","‚ùå webform loaded but iframe not rendered. This usually means CP is configured for Modal or the CP type isn‚Äôt Embedded Web Form.");
            }
          }, 300);

          return;
        }

        if (tries > 40) {
          clearInterval(wait);
          setStatus("error","‚ùå OneTrust.webform not found. Stub not initialising.");
        }
      }, 250);
    })();
  </script>
</body>
</html>
