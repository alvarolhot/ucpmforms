<!-- UCPM DEMO VERSION 3.4 ‚Äì 20:18 -->

<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UCPM DEMO VERSION 3.4</title>

  <style>
    body { margin:0; background:#f6f7f9; font-family:system-ui; }
    .wrap { max-width:980px; margin:0 auto; padding:24px; }

    .version-banner{
      background:#111827; color:#fff; padding:12px 16px; border-radius:12px;
      font-weight:800; margin-bottom:16px;
    }
    .status{
      padding:10px 12px; border-radius:10px; margin-bottom:12px; font-weight:800;
      border:1px solid #e5e7eb;
    }
    .loading{ background:#fff7ed; color:#b45309; }
    .ok{ background:#ecfdf5; color:#047857; }
    .error{ background:#fef2f2; color:#b91c1c; }

    .container{
      border:1px solid #e5e7eb; border-radius:12px; min-height:520px;
      padding:12px; background:#fff; overflow:visible;
    }

    #ucpm-embedded-form iframe{
      width:100% !important; min-height:650px; border:0 !important; display:block;
    }
  </style>

  <!-- ‚úÖ OneTrust stub with correct worker for your tenant -->
  <script
    defer
    src="https://privacyportaltrial.onetrust.com/consent-embedded-forms/consent-receipt-scripts/OtFormStub.js"
    data-id="86cfa775-f542-42b6-8f6d-30a22fc81ba1"
    worker="https://privacyportaltrial.onetrust.com"
    data-worker="https://privacyportaltrial.onetrust.com"
    data-domain="privacyportaltrial.onetrust.com"
  ></script>
</head>

<body>
  <div class="wrap">
    <div class="version-banner">üöÄ UCPM DEMO VERSION 3.4 ‚Äì WORKER FIX</div>

    <div id="statusBox" class="status loading">Loading OneTrust‚Ä¶</div>

    <div id="ucpm-embedded-form" class="container"></div>
  </div>

  <script>
    (function(){
      const CP_ID = "86cfa775-f542-42b6-8f6d-30a22fc81ba1";
      const statusBox = document.getElementById("statusBox");
      const target = document.getElementById("ucpm-embedded-form");

      function setStatus(type, text){
        statusBox.className = "status " + type;
        statusBox.innerText = text;
      }

      function hasIframe(){
        return !!(target.querySelector("iframe") || document.querySelector("iframe"));
      }

      setStatus("loading","Waiting for OneTrust.webform‚Ä¶");

      let tries = 0;
      const t = setInterval(() => {
        tries++;

        const webform = window.OneTrust && window.OneTrust.webform;
        if (webform && typeof webform.InstallCP === "function") {
          clearInterval(t);

          setStatus("loading","SDK ready. Installing CP (manual)‚Ä¶");

          // Try install with target hints (tenant-dependent)
          try {
            webform.InstallCP(CP_ID, { target:"#ucpm-embedded-form", container:"#ucpm-embedded-form", inline:true }, function(r){
              console.log("InstallCP callback:", r);
            });
          } catch(e) {
            // Fallback signature
            try { webform.InstallCP(CP_ID); } catch(_) {}
          }

          let checks = 0;
          const c = setInterval(() => {
            checks++;
            if (hasIframe()) {
              clearInterval(c);
              setStatus("ok","‚úÖ Form rendered.");
            }
            if (checks > 35) {
              clearInterval(c);
              setStatus("error","‚ùå SDK ok but no iframe. Next step: open Network ‚Üí Response of /cfw/... to see exact reason.");
            }
          }, 300);

          return;
        }

        if (tries > 40) {
          clearInterval(t);
          setStatus("error","‚ùå OneTrust.webform not detected.");
        }
      }, 250);
    })();
  </script>
</body>
</html>
