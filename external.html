<!-- external.html -->
<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>External Web Form (HTML + SDK)</title>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background:#f6f7f9; color:#0f172a; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }

    .top { display:flex; justify-content:space-between; align-items:flex-start; gap: 12px; margin-bottom: 14px; }
    .brand { display:flex; flex-direction:column; gap: 6px; }
    .brand h1 { margin:0; font-size: 20px; letter-spacing: -0.02em; }
    .brand p { margin:0; color:#64748b; font-size: 13px; line-height: 1.35; }

    .back-btn {
      display:inline-flex; align-items:center; gap: 8px;
      padding: 8px 14px; border-radius: 999px;
      text-decoration:none; font-size: 13px; font-weight: 800;
      color:#1d4ed8; background: rgba(37,99,235,.08);
      border: 1px solid rgba(37,99,235,.25); white-space: nowrap;
      transition: transform .12s ease, background .12s ease;
    }
    .back-btn:hover { transform: translateY(-1px); background: rgba(37,99,235,.12); }

    .card {
      background:#fff; border-radius: 14px; padding: 18px; margin: 14px 0;
      box-shadow: 0 2px 10px rgba(0,0,0,.06); border: 1px solid #eef0f3;
    }
    /* ✅ Fix overflow + alignment */
*,
*::before,
*::after {
  box-sizing: border-box;
}

.ot-form-consent {
  width: 100%;
  max-width: 100%;
  margin: 0;
  padding: 0;
}

.formShell {
  width: 100%;
}

.field {
  width: 100%;
  min-width: 0; /* importante para grid overflow */
}

input.ot-form-control {
  width: 100%;
  max-width: 100%;
  display: block;
}

.checkItem {
  width: 100%;
}

.grid > * {
  min-width: 0; /* evita que grid fuerce overflow */
}
    .formShell{
      max-width: 560px;
      margin: 0 auto;
      padding: 14px;
      border-radius: 16px;
      border: 1px solid #eef0f3;
      background: linear-gradient(180deg, #ffffff 0%, #fbfdff 100%);
      box-shadow: 0 10px 30px rgba(2,6,23,.06);
    }

    .formHeader{
      display:flex; align-items:flex-start; justify-content:space-between; gap: 10px;
      margin-bottom: 10px;
    }
    .formHeader h2{
      margin:0;
      font-size: 15px;
      font-weight: 900;
      letter-spacing: -0.01em;
    }
    .tag{
      display:inline-flex; align-items:center; gap:8px;
      padding: 5px 10px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #fafafa;
      font-size: 12px;
      color:#475569;
      font-weight: 800;
      white-space: nowrap;
    }

    .grid {
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-top: 10px;
    }

    .field { display:flex; flex-direction:column; gap: 6px; }
    .labelRow { display:flex; align-items:center; justify-content:space-between; gap: 8px; }
    label{
      font-size: 12.5px;
      font-weight: 900;
      color:#0f172a;
    }
    .optional{
      font-size: 11px;
      font-weight: 800;
      color:#94a3b8;
    }

    input.ot-form-control{
      width:100%;
      padding: 11px 12px;
      font-size: 14px;
      border-radius: 12px;
      border: 1px solid rgba(15, 23, 42, 0.14);
      background:#fff;
      outline: none;
      transition: box-shadow .12s ease, border-color .12s ease;
    }
    input.ot-form-control:focus{
      border-color: rgba(37,99,235,.55);
      box-shadow: 0 0 0 3px rgba(37,99,235,.12);
    }

    .checks{
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px dashed #e5e7eb;
      display:flex;
      flex-direction:column;
      gap: 10px;
    }
    .checkItem{
      display:flex;
      gap: 10px;
      align-items:flex-start;
      padding: 10px 10px;
      border: 1px solid #eef0f3;
      border-radius: 12px;
      background:#fff;
    }
    .checkItem input{ margin-top: 2px; }
    .checkText{
      display:flex; flex-direction:column; gap: 2px;
      font-size: 13px;
      color:#334155;
      line-height: 1.25;
    }
    .checkText strong{
      font-size: 13px;
      font-weight: 900;
      color:#0f172a;
    }
    .checkText span{
      font-size: 12px;
      color:#64748b;
    }

    .actions{
      margin-top: 12px;
      display:flex;
      gap: 10px;
      align-items:center;
    }

    .ot-submit-button{
      flex: 1;
      display: inline-flex;
      justify-content:center;
      align-items:center;
      padding: 11px 14px;
      font-size: 14px;
      font-weight: 900;
      border-radius: 12px;
      color: #fff;
      background: #2563eb;
      border: 1px solid rgba(37,99,235,.35);
      cursor:pointer;
      transition: transform .12s ease, filter .12s ease;
    }
    .ot-submit-button:hover{ transform: translateY(-1px); filter: brightness(0.98); }

    .ghostBtn{
      display:inline-flex; align-items:center; justify-content:center;
      padding: 11px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background:#fff;
      color:#334155;
      font-weight: 900;
      cursor:pointer;
    }
    .ghostBtn:hover{ background:#f8fafc; }

    .status {
      max-width: 560px;
      margin: 12px auto 0;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      background:#fafafa;
      font-size: 12.5px;
      color:#334155;
      line-height: 1.35;
    }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    @media (max-width: 760px) {
      .wrap { padding: 18px; }
      .grid { grid-template-columns: 1fr; }
    }
  </style>
</head>

<body>
  <main class="wrap">
    <div class="top">
      <div class="brand">
        <h1>2) External Web Form (HTML + SDK)</h1>
        <p>Stops page navigation on submit (no 405), while OneTrust SDK still sends the receipt.</p>
      </div>
      <a class="back-btn" href="./index.html">← Back to selector</a>
    </div>

    <section class="card">

      <div class="formShell">
        <div class="formHeader">
          <div>
            <h2>Consent & Preferences</h2>
          </div>
          <span class="tag">HTML + SDK</span>
        </div>

        <!-- OneTrust-generated form, restyled -->
        <form class="ot-form-consent" action="#" method="post"
          data-ot-cp-id="299d23f4-cdd2-4fc2-9009-9ed75b7719d6-active"
          id="otExternalForm"
          novalidate
        >
          <input type="hidden" id="confirmation" name="receiptId" value="" />

          <div class="grid">
            <div class="field" style="grid-column: 1 / -1;">
              <div class="labelRow">
                <label for="inputEmail">Email</label>
                <span class="optional">required</span>
              </div>
              <input type="email" id="inputEmail" name="Email" class="ot-form-control" placeholder="name@company.com" required>
            </div>

            <div class="field">
              <div class="labelRow">
                <label for="FirstName">First name</label>
                <span class="optional">optional</span>
              </div>
              <input type="text" id="FirstName" name="FirstName" class="ot-form-control" placeholder="Alex">
            </div>

            <div class="field">
              <div class="labelRow">
                <label for="LastName">Last name</label>
                <span class="optional">optional</span>
              </div>
              <input type="text" id="LastName" name="LastName" class="ot-form-control" placeholder="Johnson">
            </div>

            <div class="field" style="grid-column: 1 / -1;">
              <div class="labelRow">
                <label for="Mobile">Mobile</label>
                <span class="optional">optional</span>
              </div>
              <input type="text" id="Mobile" name="Mobile" class="ot-form-control" placeholder="+34 600 000 000">
            </div>
          </div>

          <div class="checks">
            <div class="checkItem">
              <input value="Marketing Email Communications" name="purpose_marketing" type="checkbox" id="p1">
              <div class="checkText">
                <strong>Marketing Email Communications</strong>
                <span>Receive newsletters, product updates, and promotions.</span>
              </div>
            </div>

            <div class="checkItem">
              <input value="Profiling" name="purpose_profiling" type="checkbox" id="p2">
              <div class="checkText">
                <strong>Profiling</strong>
                <span>Personalize content and experiences based on your activity.</span>
              </div>
            </div>
          </div>

          <div class="actions">
            <button id="trigger" class="ot-submit-button" type="submit">Submit</button>
            <button class="ghostBtn" type="reset">Reset</button>
          </div>
        </form>
      </div>

      <div class="status" id="statusBox">
        <strong>Status:</strong> Ready. Open DevTools → <span class="mono">Network</span> and filter for “consent” / “receipt”.
      </div>

      <!-- OneTrust SDK (as provided) -->
      <script
        src="https://privacyportaltrial-cdn.onetrust.com/consent-receipt-scripts/scripts/otconsent-1.0.min.js"
        type="text/javascript"
        data-ot-id="86cfa775-f542-42b6-8f6d-30a22fc81ba1"
        charset="UTF-8"
        id="consent-receipt-script"
        data-ot-consent-register-event="document-load"
      ></script>

      <script>
        (function () {
          const form = document.getElementById("otExternalForm");
          const statusBox = document.getElementById("statusBox");

          // ✅ HARD STOP for navigation (fixes 405):
          // We capture the submit BEFORE default navigation happens.
          // We DO stop propagation so the page never navigates.
          // The SDK still sends the receipt because it already registered handlers on load
          // and/or fires based on the click/field state.
          function blockNavigation(e){
            e.preventDefault();
            e.stopPropagation();
            if (typeof e.stopImmediatePropagation === "function") e.stopImmediatePropagation();
          }

          // Capture phase submit interception
          form.addEventListener("submit", function(e){
            blockNavigation(e);
            statusBox.innerHTML =
              "<strong>Status:</strong> Submit blocked (no navigation). If the SDK is active, it will still send the receipt. Check <span class='mono'>Network</span>.";
          }, true);

          // Also block Enter key causing implicit submit
          form.addEventListener("keydown", function(e){
            if (e.key === "Enter") {
              // allow enter inside inputs but prevent navigation
              // OneTrust SDK will still see the state and can send via its own XHR
              blockNavigation(e);
              document.getElementById("trigger").click();
            }
          }, true);

          // Optional: small UX feedback
          document.getElementById("trigger").addEventListener("click", function(){
            statusBox.innerHTML =
              "<strong>Status:</strong> Sending… (watch <span class='mono'>Network</span> for the XHR).";
            setTimeout(() => {
              statusBox.innerHTML =
                "<strong>Status:</strong> Sent (if receipt created). If you see DS created in OneTrust, you’re good — and no 405 page should appear.";
            }, 900);
          });
        })();
      </script>

    </section>
  </main>
</body>
</html>
