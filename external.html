<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>External Web Form (HTML + SDK)</title>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background:#f6f7f9; color:#0f172a; }
    .wrap { max-width: 980px; margin: 0 auto; padding: 24px; }
    .card { background:#fff; border-radius: 14px; padding: 18px; margin: 14px 0; border: 1px solid #eef0f3; box-shadow: 0 2px 10px rgba(0,0,0,.06); }
    .back-btn { display:inline-flex; align-items:center; gap:8px; padding:8px 14px; border-radius:999px; text-decoration:none; font-size:13px; font-weight:700; color:#1d4ed8; background:rgba(37,99,235,.08); border:1px solid rgba(37,99,235,.25); }
    .muted { color:#64748b; font-size: 13px; }
    .log { margin-top: 12px; border: 1px dashed #d7dbe0; border-radius: 12px; padding: 12px; background: #fafafa; }
    .log pre { margin:0; font-size:12px; white-space:pre-wrap; word-break: break-word; }

    /* --- OneTrust form styling (from generator) --- */
    .ot-form-consent { max-width: 500px; padding: 15px; margin: 0 auto; }
    .ot-form-signin .ot-checkbox { margin-bottom: 10px; font-weight: normal; }
    .ot-form-signin .ot-form-control {
      position: relative; height: auto; padding: 10px; font-size: 16px;
      margin-bottom: 20px; display: block; width: 100%; line-height: 1.25;
      border: 1px solid rgba(19, 12, 12, 0.15); border-radius: .25rem;
    }
    .ot-form-signin .ot-form-control:focus { z-index: 2; }
    .ot-form-signin input[type="email"] { margin-bottom: -1px; border-bottom-right-radius: 0; border-bottom-left-radius: 0; }
    .ot-checkbox { margin-top: 10px; }
    .ot-ml-1 { margin-left: 1rem !important; }
    .ot-submit-button {
      display: block; padding: .75rem 1.5rem; font-size: 1.25rem; border-radius: .3rem;
      color: #fff; background-color: #0275d8; border-color: #0275d8; margin: auto;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <main class="wrap">
    <a class="back-btn" href="./index.html">← Back to selector</a>

    <section class="card">
      <h1 style="margin:0 0 6px;">External Web Form (HTML + SDK)</h1>
      <p class="muted" style="margin:0;">
        This simulates an “External Web Form Integration”: your HTML form + OneTrust SDK binds and submits consent.
      </p>
    </section>

    <section class="card">
      <!-- ✅ Keep exactly ONE form with data-ot-cp-id -->
      <form class="ot-form-consent ot-form-signin" action="" method="post"
        data-ot-cp-id="299d23f4-cdd2-4fc2-9009-9ed75b7719d6-active"
        id="ot-external-form">

        <input type="hidden" id="confirmation" name="receiptId" value="" />

        <label for="inputEmail">Email</label>
        <!-- ✅ Add name -->
        <input type="email" id="inputEmail" name="Email" class="ot-form-control" placeholder="Email" required>

        <label for="Mobile">Mobile</label>
        <input type="text" id="Mobile" name="Mobile" class="ot-form-control" placeholder="Mobile">

        <label for="FirstName">First Name</label>
        <input type="text" id="FirstName" name="FirstName" class="ot-form-control" placeholder="First Name">

        <label for="LastName">Last Name</label>
        <input type="text" id="LastName" name="LastName" class="ot-form-control" placeholder="Last Name">

        <!-- ✅ Add name to checkboxes so SDK can read selected purposes -->
        <div class="ot-checkbox">
          <label>
            <input name="Purposes" value="Marketing Email Communications" type="checkbox">
            Marketing Email Communications
          </label>
        </div>

        <div class="ot-checkbox">
          <label>
            <input name="Purposes" value="Profiling" type="checkbox">
            Profiling
          </label>
        </div>

        <button id="trigger" class="ot-submit-button" type="submit">Submit form</button>
      </form>

      <div class="log">
        <strong>Debug</strong>
        <pre id="debug"></pre>
      </div>
    </section>
  </main>

  <!-- ✅ OneTrust SDK (exactly as provided) -->
  <script
    src="https://privacyportaltrial-cdn.onetrust.com/consent-receipt-scripts/scripts/otconsent-1.0.min.js"
    type="text/javascript"
    data-ot-id="86cfa775-f542-42b6-8f6d-30a22fc81ba1"
    charset="UTF-8"
    id="consent-receipt-script"
    data-ot-consent-register-event="document-load"
  ></script>

  <!-- Lightweight diagnostics (won’t break anything) -->
  <script>
    (function () {
      const debugEl = document.getElementById("debug");
      const form = document.getElementById("ot-external-form");

      function log(msg, obj) {
        const line = obj ? msg + "\n" + JSON.stringify(obj, null, 2) : msg;
        debugEl.textContent = line + "\n\n" + debugEl.textContent;
        console.log(msg, obj || "");
      }

      window.addEventListener("load", () => {
        log("Page loaded", {
          url: location.href,
          origin: location.origin,
          hasOTScript: !!document.getElementById("consent-receipt-script"),
          cpId: form.getAttribute("data-ot-cp-id"),
          otId: document.getElementById("consent-receipt-script")?.getAttribute("data-ot-id") || null
        });
      });

      // Log what the form will submit (so we confirm fields are present)
      form.addEventListener("submit", (e) => {
        const fd = new FormData(form);
        const payload = {};
        fd.forEach((v, k) => {
          if (payload[k]) payload[k] = [].concat(payload[k], v);
          else payload[k] = v;
        });
        log("Form submit captured (before SDK)", payload);
      });
    })();
  </script>
</body>
</html>
