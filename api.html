<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UCPM – Custom Form (API)</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      background-color: #f4f6f8;
      color: #1f2937;
    }

    .container {
      max-width: 900px;
      margin: 40px auto;
      padding: 20px;
    }

    h1 {
      font-size: 22px;
      margin-bottom: 20px;
      color: #003b5c;
    }

    .card {
      background: #ffffff;
      border: 1px solid #d1d5db;
      padding: 20px;
      border-radius: 6px;
    }

    .row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-bottom: 15px;
    }

    label {
      display: block;
      font-size: 13px;
      margin-bottom: 6px;
    }

    input[type="text"],
    input[type="email"],
    input[type="tel"] {
      width: 100%;
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 4px;
    }

    .checkbox {
      margin-bottom: 10px;
      font-size: 13px;
    }

    button {
      padding: 10px 14px;
      border-radius: 4px;
      border: 1px solid #003b5c;
      background: #003b5c;
      color: white;
      cursor: pointer;
      font-size: 13px;
    }

    button:hover {
      background: #002b45;
    }

    .log {
      margin-top: 20px;
      padding: 10px;
      border: 1px dashed #d1d5db;
      background: #fafafa;
      font-size: 12px;
      white-space: pre-wrap;
    }

    .back {
      display: inline-block;
      margin-bottom: 20px;
      text-decoration: none;
      font-size: 13px;
      color: #003b5c;
    }

    @media (max-width: 768px) {
      .row {
        grid-template-columns: 1fr;
      }
    }

  </style>
</head>

<body>

  <div class="container">

    <a class="back" href="./index.html">← Back to selector</a>

    <h1>Custom Form → Consent Receipt API</h1>

    <div class="card">

      <form id="apiForm">

        <div class="row">
          <div>
            <label>Email (Identifier)</label>
            <input type="email" id="email" required />
          </div>

          <div>
            <label>Mobile</label>
            <input type="tel" id="mobile" />
          </div>
        </div>

        <div class="row">
          <div>
            <label>First Name</label>
            <input type="text" id="firstName" />
          </div>

          <div>
            <label>Last Name</label>
            <input type="text" id="lastName" />
          </div>
        </div>

        <div class="checkbox">
          <input type="checkbox" id="marketing" checked />
          Marketing Communications
        </div>

        <div class="checkbox">
          <input type="checkbox" id="profiling" />
          Profiling
        </div>

        <button type="submit">Submit Consent (API)</button>

      </form>

      <div class="log" id="log"></div>

    </div>
  </div>

<script>

const API_URL = "https://privacyportaltrial.onetrust.com/request/v1/consentreceipts";
const TOKEN_KEY = "ucpm_requestInformation_jwt";

function getJwt() {
  const jwt = sessionStorage.getItem(TOKEN_KEY);
  return jwt ? jwt.trim() : null;
}

document.getElementById("apiForm").addEventListener("submit", async function(e) {
  e.preventDefault();

  const jwt = getJwt();
  if (!jwt) {
    alert("No JWT found in sessionStorage.");
    return;
  }

  const body = {
    identifier: document.getElementById("email").value.trim(),
    requestInformation: jwt,
    purposes: [],
    dsDataElements: {
      Mobile: document.getElementById("mobile").value.trim(),
      FirstName: document.getElementById("firstName").value.trim(),
      LastName: document.getElementById("lastName").value.trim()
    }
  };

  if (document.getElementById("marketing").checked) {
    body.purposes.push({
      Id: "d8aecf6d-3f4a-4354-b752-8a6663b5d83f",
      TransactionType: "CONFIRMED"
    });
  }

  if (document.getElementById("profiling").checked) {
    body.purposes.push({
      Id: "eaddf865-9b70-445b-a36c-fdddc9de1697",
      TransactionType: "CONFIRMED"
    });
  }

  const log = document.getElementById("log");
  log.innerText = "Submitting...\n";

  try {
    const res = await fetch(API_URL, {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(body)
    });

    const data = await res.json();
    log.innerText = "Success:\n" + JSON.stringify(data, null, 2);

  } catch (err) {
    log.innerText = "Error:\n" + err;
  }

});

</script>

</body>
</html>
